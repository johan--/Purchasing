
%span{ bind: { class: ':edit_box isCancelled isReconciled' } }
  %h2{ hb: 'bind-attr class="allReceived"'}
    %span{ bind: { class: ':box_title isCancelled:strikethrough' } }
      -if permitted_to? :update, :purchases
        =hb 'partial "views/star"'
      -else
        =hb 'partial "views/star_noaction"'
      =hb 'if id' do
        Edit record
        =hb 'id'
        =hb 'else'
        New Record
      =hb 'buyer.name'
    .edit_bar_controls
      .attachments{ _action: 'openAttachments' }
        =fa_icon 'thumb-tack lg'
        Attachments
        =hb 'attachmentCount'

      .email{ _action: 'emailRequisition' }
        =fa_icon 'envelope lg'
        Email
      .print{ _action: 'printRequisition' }
        =fa_icon 'print lg'
        Print
  =hb 'render attachments this.attachments'

  .edit_box_content
    .top_info
      -if permitted_to? :update, :purchases
        =hb 'partial "purchase/top_edit"'
      -else
        =hb 'partial "purchase/top_view"'

    .middle_info
      -if permitted_to? :read, :line_items
        .line_items_container
          =hb 'render "LineItems" lineItems'

      -if permitted_to? :read, :receivings
        .receiving_container
          =hb 'render "Receivings" receivings'

    .bottom_info
      .notes_tags
        -if permitted_to? :read, :notes
          =hb 'render "Notes" notes'

        -if permitted_to? :read, :tags
          =hb 'render "Tags" tags'


      .account_container
        .edit_title
          Accounts
        .account
          =hb 'view App.AccountsView'

        .totals
          %dl
            %dt Sub-total
            %dd=hb 'currency subTotal'
          %dl
            %dt
              Tax at
              =hb 'if isEditingTaxRate' do
                =hb 'view App.TaxSelect'
                %span.clickable{ _action: 'stopEditingTaxRate' }
                  Cancel
                =hb 'else'
                %span.clickable{ _action: 'startEditingTaxRate' }
                  =hb 'tax_rate'
            %dd=hb 'currency tax'
          %dl
            %dt Labor
            %dd=hb 'view App.PriceInput value=labor'
          %dl
            %dt Shipping
            %dd=hb 'view App.PriceInput value=shipping'
          %dl.total
            %dt Grand Total
            %dd=hb 'currency grandTotal'

      .bottom_left

        -if permitted_to? :delete, :purchases
          .big_delete_button.red{ _action: 'deleteRecord'}
            =fa_icon 'trash-o'
            Delete Record

        %span{ _action: 'toggleCancelled', bind: { class: ':button :grey isCancelled:button_down' } }
          Cancel Order

        .last_modified
          Last Modified:
          =hb 'largeDate updated_at'
          %br
          Last Modified by:
          =hb 'last_user'
      .bottom_right
        .button.bottom_button.red{ _action: 'cancelEdit' }
          =fa_icon 'rotate-left'
          Cancel
        -if permitted_to? :update, :purchases
          .button.bottom_button.green{ _action: 'saveRecord' }
            =fa_icon 'save'
            Submit

  #flash_parent
    =hb 'view App.NotificationView'
