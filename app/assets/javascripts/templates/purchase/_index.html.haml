.edit_box
  %h2{ hb: 'bind-attr class="allReceived"'}
    .box_title
      -if permitted_to? :update, :purchases
        =hb 'partial "views/star"'
      -else
        =hb 'partial "views/star_noaction"'
      =hb 'if id' do
        Edit record
        =hb 'id'
        =hb 'else'
        New Record
      =hb 'buyer.name'
    .edit_bar_controls
      -if permitted_to? :delete, :purchases
        .big_delete_button.red{ _action: 'deleteRecord'}
          =fa_icon 'times'
          Delete Record
      .attachments
        =fa_icon 'thumb-tack lg'
        Attachments
        =hb 'attachmentCount'
      .email{ _action: 'emailRequisition' }
        =fa_icon 'envelope lg'
        Email
      .print{ _action: 'printRequisition' }
        =fa_icon 'print lg'
        Print

  .edit_box_content
    .top_info
      -if permitted_to? :update, :purchases
        =hb 'partial "purchase/top_edit"'
      -else
        =hb 'partial "purchase/top_view"'

    .middle_info
      -if permitted_to? :read, :line_items
        .line_items_container
          =hb 'render "LineItems" lineItems'

      -if permitted_to? :read, :receivings
        .receiving_container
          =hb 'render "Receivings" receivings'

    .bottom_info
      -if permitted_to? :read, :notes
        .note_container
          =hb 'render "Notes" notes'

      .account_container
        .edit_title
          Accounts
        .account
          %dl
            %dt Account:
            %dd
              -if permitted_to? :update, :purchases
                =hb 'view App.AccountSelect contentBinding="accountsList" selectionBinding="accountCurrent"'
              -else
                =hb 'accountCurrent'

          -permitted_to? :create, :accounts do
            .new_account_fields.hidden
              %span.new_fund_field
                =hb 'input id="fund" value="101000" placeholder="Fund"'
              %span.new_org_field
                =hb 'input id="org" placeholder="Org"'
              %span.new_acct_field
                =hb 'input id="acct" placeholder="Acct"'

              %span{ _action: "newAccountCancel" }
                Cancel
              %span{ _action: "newAccountSave" }
                Save
            .new_account_loading.hidden
              Saving...

        .totals
          %dl
            %dt Sub-total
            %dd=hb 'currency subTotal'
          %dl
            %dt="Tax at #{hb 'percent tax_rate'}"
            %dd=hb 'currency tax'
          %dl
            %dt Labor
            %dd=hb 'view App.PriceInput value=labor'
          %dl
            %dt Shipping
            %dd=hb 'view App.PriceInput value=shipping'
          %dl.total
            %dt Grand Total
            %dd=hb 'currency grandTotal'

      .bottom_left
        -if permitted_to? :read, :tags
          .tags_container
            .tags_header
              Tags
            .tags
              =hb 'render "Tags" tags'

      .bottom_right
        .button.bottom_button.red{ _action: 'cancelEdit' }
          =fa_icon 'rotate-left'
          Cancel
        -if permitted_to? :update, :purchases
          .button.bottom_button.green{ _action: 'saveRecord' }
            =fa_icon 'save'
            Submit

  #flash_parent
    =hb 'view App.NotificationView'
